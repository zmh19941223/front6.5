# å››ã€é¦–é¡µâ€”æ–‡ç« åˆ—è¡¨

<img src="./assets/1566539328996.png" width="250">

## é¡µé¢å¸ƒå±€

### å¤´éƒ¨å¯¼èˆªæ 

1ã€ä½¿ç”¨å¯¼èˆªæ ç»„ä»¶

2ã€åœ¨å¯¼èˆªæ ç»„ä»¶ä¸­æ’å…¥æŒ‰é’®

- æ–‡æœ¬
- å›¾æ ‡

3ã€æ ·å¼è°ƒæ•´

- å®½é«˜
- èƒŒæ™¯è‰²
- è¾¹æ¡†
- æ–‡æœ¬å¤§å°
- å›¾æ ‡å¤§å°

```html
<template>
  <div class="home-container">
    <!-- å¯¼èˆªæ  -->
    <van-nav-bar class="page-nav-bar">
      <van-button
        class="search-btn"
        slot="title"
        type="info"
        size="small"
        round
        icon="search"
      >æœç´¢</van-button>
    </van-nav-bar>
    <!-- /å¯¼èˆªæ  -->
  </div>
</template>

<script>
export default {
  name: 'HomeIndex',
  components: {},
  props: {},
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.home-container {
  .van-nav-bar__title {
    max-width: unset;
  }
  .search-btn {
    width: 555px;
    height: 64px;
    background-color: #5babfb;
    border: none;
    font-size: 28px;
    .van-icon {
      font-size: 32px;
    }
  }
}
</style>

```



## é¢‘é“åˆ—è¡¨

<img src="assets/image-20200305195458197.png" alt="image-20200305195458197" style="zoom: 80%;" />

### ä½¿ç”¨ Tab æ ‡ç­¾é¡µç»„ä»¶

å‚è€ƒï¼š[Tab æ ‡ç­¾é¡µç»„ä»¶](https://youzan.github.io/vant/#/zh-CN/tab)

### æ ·å¼è°ƒæ•´

ï¼ˆ1ï¼‰åŸºç¡€æ ·å¼è°ƒæ•´

- æ ‡ç­¾é¡¹
  + å³è¾¹æ¡†
  + ä¸‹è¾¹æ¡†
  + å®½é«˜
  + æ–‡å­—å¤§å°
  + æ–‡å­—é¢œè‰²
- åº•éƒ¨æ¡
  + å®½é«˜
  + é¢œè‰²
  + ä½ç½®


ï¼ˆ2ï¼‰å¤„ç†æ±‰å ¡æŒ‰é’®

1ã€ä½¿ç”¨æ’æ§½æ’å…¥å†…å®¹

2ã€æ ·å¼è°ƒæ•´

- å®šä½
- å†…å®¹å±…ä¸­
- å®½é«˜
- èƒŒæ™¯è‰²ã€é€æ˜åº¦
- å­—ä½“å›¾æ ‡å¤§å°


3ã€ä½¿ç”¨ä¼ªå…ƒç´ è®¾ç½®æ¸å˜è¾¹æ¡†

+ å®šä½
+ å®½é«˜
+ èƒŒæ™¯å›¾
+ èƒŒæ™¯å›¾å¡«å……æ¨¡å¼

4ã€æ·»åŠ å ä½ç¬¦å……å½“å†…å®¹åŒºåŸŸ

<img src="assets/image-20200402215736215.png" alt="image-20200402215736215" style="zoom:50%;" />

CSS æ ·å¼ï¼š

```less
.placeholder {
  flex-shrink: 0;
  width: 66px;
  height: 82px;
}

.hamburger-btn {
  position: fixed;
  right: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  width: 66px;
  height: 82px;
  background-color: #fff;
  opacity: 0.902;
  i.toutiao {
    font-size: 33px;
  }
  &:before {
    content: "";
    position: absolute;
    left: 0;
    width: 1px;
    height: 100%;
    background-image: url(~@/assets/gradient-gray-line.png);
    background-size: contain;
  }
}
```
















### å±•ç¤ºé¢‘é“åˆ—è¡¨

æ€è·¯ï¼š

1. æ‰¾æ•°æ®æ¥å£
2. æŠŠæ¥å£å°è£…ä¸ºè¯·æ±‚æ–¹æ³•
3. åœ¨ç»„ä»¶ä¸­è¯·æ±‚è·å–æ•°æ®
4. æ¨¡æ¿ç»‘å®š



1ã€å°è£…æ•°æ®è¯·æ±‚æ¥å£

```js
/**
 * è·å–ç”¨æˆ·è‡ªå·±çš„ä¿¡æ¯
 */
export const getUserChannels = () => {
  return request({
    method: 'GET',
    url: '/app/v1_0/user/channels'
  })
}
```

2ã€è¯·æ±‚è·å–æ•°æ®

<img src="assets/image-20200401004107079.png" alt="image-20200401004107079" style="zoom:50%;" />

3ã€æ¨¡æ¿ç»‘å®š

<img src="assets/image-20200401004138232.png" alt="image-20200401004138232" style="zoom:50%;" />

























## æ–‡ç« åˆ—è¡¨

<img src="assets/image-20200311221143472.png" alt="image-20200311221143472" style="zoom: 50%;" />

### æ€è·¯åˆ†æ

ä½ çš„æ€è·¯å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

1ã€æ‰¾åˆ°æ•°æ®æ¥å£

2ã€å°è£…è¯·æ±‚æ–¹æ³•

3ã€åœ¨ç»„ä»¶ä¸­è¯·æ±‚è·å–æ•°æ®ï¼Œå°†æ•°æ®å­˜å‚¨åˆ° data ä¸­

4ã€æ¨¡æ¿ç»‘å®šå±•ç¤º



æ ¹æ®ä¸åŒçš„é¢‘é“åŠ è½½ä¸åŒçš„æ–‡ç« åˆ—è¡¨ï¼Œä½ çš„æ€è·¯å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š

- æœ‰ä¸€ä¸ª `list` æ•°ç»„ï¼Œç”¨æ¥å­˜å‚¨æ–‡ç« åˆ—è¡¨
- æŸ¥çœ‹ `a` é¢‘é“ï¼šè¯·æ±‚è·å–æ•°æ®ï¼Œè®© `list = a` é¢‘é“æ–‡ç« 
- æŸ¥çœ‹ `b` é¢‘é“ï¼šè¯·æ±‚è·å–æ•°æ®ï¼Œè®© `list = b` é¢‘é“æ–‡ç« 
- æŸ¥çœ‹ `c` é¢‘é“ï¼šè¯·æ±‚è·å–æ•°æ®ï¼Œè®© `list = c` é¢‘é“æ–‡ç« 
- ...

![image-20200111124415227](assets/image-20200111124415227.png)

æ€è·¯æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœã€‚

æˆ‘ä»¬æƒ³è¦çš„æ•ˆæœæ˜¯ï¼š**åŠ è½½è¿‡çš„æ•°æ®åˆ—è¡¨ä¸è¦é‡æ–°åŠ è½½**ã€‚



å®ç°æ€è·¯ä¹Ÿéå¸¸ç®€å•ï¼Œå°±æ˜¯æˆ‘ä»¬å‡†å¤‡**å¤šä¸ª list æ•°ç»„ï¼Œæ¯ä¸ªé¢‘é“å¯¹åº”ä¸€ä¸ªï¼ŒæŸ¥çœ‹å“ªä¸ªé¢‘é“å°±æŠŠæ•°æ®å¾€å“ªä¸ªé¢‘é“çš„åˆ—è¡¨æ•°ç»„ä¸­å­˜æ”¾ï¼Œè¿™æ ·çš„è¯å°±ä¸ä¼šå¯¼è‡´è¦†ç›–é—®é¢˜**ã€‚

![image-20200111124530323](assets/image-20200111124530323.png)



å¯æ˜¯æœ‰å¤šå°‘é¢‘é“å°±å¾—æœ‰å¤šå°‘é¢‘é“æ–‡ç« æ•°ç»„ï¼Œæˆ‘ä»¬éƒ½ä¸€ä¸ªä¸€ä¸ªå£°æ˜çš„è¯ä¼šéå¸¸éº»çƒ¦ï¼Œæ‰€ä»¥è¿™é‡Œçš„å»ºè®®æ˜¯åˆ©ç”¨ç»„ä»¶æ¥å¤„ç†ã€‚

å…·ä½“åšæ³•å°±æ˜¯ï¼š

- å°è£…ä¸€ä¸ªæ–‡ç« åˆ—è¡¨ç»„ä»¶
- ç„¶ååœ¨é¢‘é“åˆ—è¡¨ä¸­æŠŠæ–‡ç« åˆ—è¡¨éå†å‡ºæ¥

**å› ä¸ºæ–‡ç« åˆ—è¡¨ç»„ä»¶ä¸­è¯·æ±‚è·å–æ–‡ç« åˆ—è¡¨æ•°æ®éœ€è¦é¢‘é“ idï¼Œæ‰€ä»¥ é¢‘é“ id åº”è¯¥ä½œä¸º props å‚æ•°ä¼ é€’ç»™æ–‡ç« åˆ—è¡¨ç»„ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠé¢‘é“å¯¹è±¡ä¼ é€’ç»™æ–‡ç« åˆ—è¡¨ç»„ä»¶å°±å¯ä»¥äº†ã€‚**

<img src="assets/image-20200306155328108.png" alt="image-20200306155328108" style="zoom: 67%;" />

åœ¨æ–‡ç« åˆ—è¡¨ä¸­è¯·æ±‚è·å–å¯¹åº”çš„åˆ—è¡¨æ•°æ®ï¼Œå±•ç¤ºåˆ°åˆ—è¡¨ä¸­ã€‚

æœ€åæŠŠç»„ä»¶åœ¨é¢‘é“åˆ—è¡¨ä¸­éå†å‡ºæ¥ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚

![image-20200306154805522](assets/image-20200306154805522.png)



1ã€åˆ›å»º `src/views/home/components/article-list.vue`

```html
<template>
  <div class="article-list">æ–‡ç« åˆ—è¡¨</div>
</template>

<script>
export default {
  name: 'ArticleList',
  components: {},
  props: {
    channel: {
      type: Object,
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```



2ã€åœ¨ `home/index.vue` ä¸­æ³¨å†Œä½¿ç”¨

<img src="assets/image-20200305205441485.png" alt="image-20200305205441485" style="zoom:50%;" />



3ã€æœ€åæµ‹è¯•ã€‚



ç­”ç–‘ï¼š

- ä¸ºä»€ä¹ˆæ ‡ç­¾å†…å®¹æ˜¯æ‡’æ¸²æŸ“çš„ï¼Ÿ
  - å› ä¸ºè¿™æ˜¯ Tab æ ‡ç­¾é¡µç»„ä»¶æœ¬èº«æ”¯æŒçš„é»˜è®¤åŠŸèƒ½ï¼Œå¦‚æœä¸éœ€è¦å¯ä»¥é€šè¿‡é…ç½® `:lazy-render="false"` æ¥å…³é—­è¿™ä¸ªæ•ˆæœã€‚

### ä½¿ç”¨ List åˆ—è¡¨ç»„ä»¶

[List åˆ—è¡¨ç»„ä»¶](https://youzan.github.io/vant/#/zh-CN/list)ï¼šç€‘å¸ƒæµæ»šåŠ¨åŠ è½½ï¼Œç”¨äºå±•ç¤ºé•¿åˆ—è¡¨ã€‚

List ç»„ä»¶é€šè¿‡ loading å’Œ finished ä¸¤ä¸ªå˜é‡æ§åˆ¶åŠ è½½çŠ¶æ€ï¼Œ
å½“ç»„ä»¶åˆå§‹åŒ–æˆ–æ»šåŠ¨åˆ°åˆ°åº•éƒ¨æ—¶ï¼Œä¼šè§¦å‘ load äº‹ä»¶å¹¶å°† loading è®¾ç½®æˆ trueï¼Œæ­¤æ—¶å¯ä»¥å‘èµ·å¼‚æ­¥æ“ä½œå¹¶æ›´æ–°æ•°æ®ï¼Œæ•°æ®æ›´æ–°å®Œæ¯•åï¼Œå°† loading è®¾ç½®æˆ false å³å¯ã€‚
è‹¥æ•°æ®å·²å…¨éƒ¨åŠ è½½å®Œæ¯•ï¼Œåˆ™ç›´æ¥å°† finished è®¾ç½®æˆ true å³å¯ã€‚

  - `load äº‹ä»¶`ï¼š
    + List åˆå§‹åŒ–åä¼šè§¦å‘ä¸€æ¬¡ load äº‹ä»¶ï¼Œç”¨äºåŠ è½½ç¬¬ä¸€å±çš„æ•°æ®ã€‚
    + å¦‚æœä¸€æ¬¡è¯·æ±‚åŠ è½½çš„æ•°æ®æ¡æ•°è¾ƒå°‘ï¼Œå¯¼è‡´åˆ—è¡¨å†…å®¹æ— æ³•é“ºæ»¡å½“å‰å±å¹•ï¼ŒList ä¼šç»§ç»­è§¦å‘ load äº‹ä»¶ï¼Œç›´åˆ°å†…å®¹é“ºæ»¡å±å¹•æˆ–æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆã€‚
  - `loading å±æ€§`ï¼šæ§åˆ¶åŠ è½½ä¸­çš„ loading çŠ¶æ€
    + éåŠ è½½ä¸­ï¼Œloading ä¸º falseï¼Œæ­¤æ—¶ä¼šæ ¹æ®åˆ—è¡¨æ»šåŠ¨ä½ç½®åˆ¤æ–­æ˜¯å¦è§¦å‘ load äº‹ä»¶ï¼ˆåˆ—è¡¨å†…å®¹ä¸è¶³ä¸€å±å¹•æ—¶ï¼Œä¼šç›´æ¥è§¦å‘ï¼‰
    + åŠ è½½ä¸­ï¼Œloading ä¸º trueï¼Œè¡¨ç¤ºæ­£åœ¨å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œæ­¤æ—¶ä¸ä¼šè§¦å‘ load äº‹ä»¶
  - `finished å±æ€§`ï¼šæ§åˆ¶åŠ è½½ç»“æŸçš„çŠ¶æ€
    + åœ¨æ¯æ¬¡è¯·æ±‚å®Œæ¯•åï¼Œéœ€è¦æ‰‹åŠ¨å°† loading è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºæœ¬æ¬¡åŠ è½½ç»“æŸ
    + æ‰€æœ‰æ•°æ®åŠ è½½ç»“æŸï¼Œfinished ä¸º trueï¼Œæ­¤æ—¶ä¸ä¼šè§¦å‘ load äº‹ä»¶

```html
<template>
  <div class="article-list">
    <!--
      List åˆ—è¡¨ç»„ä»¶ï¼šç€‘å¸ƒæµæ»šåŠ¨åŠ è½½ï¼Œç”¨äºå±•ç¤ºé•¿åˆ—è¡¨ã€‚

      List ç»„ä»¶é€šè¿‡ loading å’Œ finished ä¸¤ä¸ªå˜é‡æ§åˆ¶åŠ è½½çŠ¶æ€ï¼Œ
      å½“ç»„ä»¶åˆå§‹åŒ–æˆ–æ»šåŠ¨åˆ°åˆ°åº•éƒ¨æ—¶ï¼Œä¼šè§¦å‘ load äº‹ä»¶å¹¶å°† loading è‡ªåŠ¨è®¾ç½®æˆ trueï¼Œæ­¤æ—¶å¯ä»¥å‘èµ·å¼‚æ­¥æ“ä½œå¹¶æ›´æ–°æ•°æ®ï¼Œ
      æ•°æ®æ›´æ–°å®Œæ¯•åï¼Œå°† loading è®¾ç½®æˆ false å³å¯ã€‚
      è‹¥æ•°æ®å·²å…¨éƒ¨åŠ è½½å®Œæ¯•ï¼Œåˆ™ç›´æ¥å°† finished è®¾ç½®æˆ true å³å¯ã€‚

      - load äº‹ä»¶ï¼š
        + List åˆå§‹åŒ–åä¼šè§¦å‘ä¸€æ¬¡ load äº‹ä»¶ï¼Œç”¨äºåŠ è½½ç¬¬ä¸€å±çš„æ•°æ®ã€‚
        + å¦‚æœä¸€æ¬¡è¯·æ±‚åŠ è½½çš„æ•°æ®æ¡æ•°è¾ƒå°‘ï¼Œå¯¼è‡´åˆ—è¡¨å†…å®¹æ— æ³•é“ºæ»¡å½“å‰å±å¹•ï¼ŒList ä¼šç»§ç»­è§¦å‘ load äº‹ä»¶ï¼Œç›´åˆ°å†…å®¹é“ºæ»¡å±å¹•æˆ–æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆã€‚

      - loading å±æ€§ï¼šæ§åˆ¶åŠ è½½ä¸­çš„ loading çŠ¶æ€
        + éåŠ è½½ä¸­ï¼Œloading ä¸º falseï¼Œæ­¤æ—¶ä¼šæ ¹æ®åˆ—è¡¨æ»šåŠ¨ä½ç½®åˆ¤æ–­æ˜¯å¦è§¦å‘ load äº‹ä»¶ï¼ˆåˆ—è¡¨å†…å®¹ä¸è¶³ä¸€å±å¹•æ—¶ï¼Œä¼šç›´æ¥è§¦å‘ï¼‰
        + åŠ è½½ä¸­ï¼Œloading ä¸º trueï¼Œè¡¨ç¤ºæ­£åœ¨å‘é€å¼‚æ­¥è¯·æ±‚ï¼Œæ­¤æ—¶ä¸ä¼šè§¦å‘ load äº‹ä»¶

      - finished å±æ€§ï¼šæ§åˆ¶åŠ è½½ç»“æŸçš„çŠ¶æ€
        + åœ¨æ¯æ¬¡è¯·æ±‚å®Œæ¯•åï¼Œéœ€è¦æ‰‹åŠ¨å°† loading è®¾ç½®ä¸º falseï¼Œè¡¨ç¤ºæœ¬æ¬¡åŠ è½½ç»“æŸ
        + æ‰€æœ‰æ•°æ®åŠ è½½ç»“æŸï¼Œfinished ä¸º trueï¼Œæ­¤æ—¶ä¸ä¼šè§¦å‘ load äº‹ä»¶
     -->
    <van-list
      v-model="loading"
      :finished="finished"
      finished-text="æ²¡æœ‰æ›´å¤šäº†"
      @load="onLoad"
    >
      <van-cell v-for="item in list" :key="item" :title="item" />
    </van-list>
  </div>
</template>

<script>
export default {
  name: 'ArticleList',
  components: {},
  props: {
    channel: {
      type: Object,
      required: true
    }
  },
  data () {
    return {
      list: [], // å­˜å‚¨åˆ—è¡¨æ•°æ®çš„æ•°ç»„
      loading: false, // æ§åˆ¶åŠ è½½ä¸­ loading çŠ¶æ€
      finished: false // æ§åˆ¶æ•°æ®åŠ è½½ç»“æŸçš„çŠ¶æ€
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {
    // åˆå§‹åŒ–æˆ–æ»šåŠ¨åˆ°åº•éƒ¨çš„æ—¶å€™ä¼šè§¦å‘è°ƒç”¨ onLoad
    onLoad () {
      console.log('onLoad')
      // 1. è¯·æ±‚è·å–æ•°æ®
      // setTimeout ä»…åšç¤ºä¾‹ï¼ŒçœŸå®åœºæ™¯ä¸­ä¸€èˆ¬ä¸º ajax è¯·æ±‚
      setTimeout(() => {
        // 2. æŠŠè¯·æ±‚ç»“æœæ•°æ®æ”¾åˆ° list æ•°ç»„ä¸­
        for (let i = 0; i < 10; i++) {
          // 0 + 1 = 1
          // 1 + 1 = 2
          // 2 + 1 = 3
          this.list.push(this.list.length + 1)
        }

        // 3. æœ¬æ¬¡æ•°æ®åŠ è½½ç»“æŸä¹‹åè¦æŠŠåŠ è½½çŠ¶æ€è®¾ç½®ä¸ºç»“æŸ
        //     loading å…³é—­ä»¥åæ‰èƒ½è§¦å‘ä¸‹ä¸€æ¬¡çš„åŠ è½½æ›´å¤š
        this.loading = false

        // 4. åˆ¤æ–­æ•°æ®æ˜¯å¦å…¨éƒ¨åŠ è½½å®Œæˆ
        if (this.list.length >= 40) {
          // å¦‚æœæ²¡æœ‰æ•°æ®äº†ï¼ŒæŠŠ finished è®¾ç½®ä¸º trueï¼Œä¹‹åä¸å†è§¦å‘åŠ è½½æ›´å¤š
          this.finished = true
        }
      }, 1000)
    }
  }
}
</script>

<style scoped lang="less"></style>

```

### è®©åˆ—è¡¨å›ºå®šå®šä½

```html
.article-list {
  position: fixed;
  top: 180px;
  bottom: 100px;
  right: 0;
  left: 0;
	overflow-y: auto;
}
```



### åŠ è½½æ–‡ç« åˆ—è¡¨æ•°æ®

å®ç°æ€è·¯ï¼š

- æ‰¾åˆ°æ•°æ®æ¥å£
- å°è£…è¯·æ±‚æ–¹æ³•
- è¯·æ±‚è·å–æ•°æ®
- æ¨¡æ¿ç»‘å®š


1ã€åˆ›å»º `src/api/article.js` å°è£…è·å–æ–‡ç« åˆ—è¡¨æ•°æ®çš„æ¥å£

```js
/**
 * æ–‡ç« æ¥å£æ¨¡å—
 */
import request from '@/utils/request'

/**
 * è·å–é¢‘é“çš„æ–‡ç« åˆ—è¡¨
 */
export const getArticles = params => {
  return request({
    method: 'GET',
    url: '/app/v1_1/articles',
    params
  })
}
```

> æ³¨æ„ï¼šä½¿ç”¨æ¥å£æ–‡æ¡£ä¸­æœ€ä¸‹é¢çš„ **é¢‘é“æ–°é—»æ¨è\_V1.1**

2ã€ç„¶ååœ¨é¦–é¡µæ–‡ç« åˆ—è¡¨ç»„ä»¶ `onload` çš„æ—¶å€™è¯·æ±‚åŠ è½½æ–‡ç« åˆ—è¡¨

```html
<template>
  <div class="article-list">
      <!--
        loading æ§åˆ¶ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„ loading çŠ¶æ€
        finished æ§åˆ¶æ•°æ®æ˜¯å¦åŠ è½½ç»“æŸ
        load äº‹ä»¶ï¼šå½“è§¦å‘ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ—¶å€™ä¼šè§¦å‘è°ƒç”¨ load äº‹ä»¶

        List åˆå§‹åŒ–åä¼šè§¦å‘ä¸€æ¬¡ load äº‹ä»¶ï¼Œç”¨äºåŠ è½½ç¬¬ä¸€å±çš„æ•°æ®
        å¦‚æœä¸€æ¬¡è¯·æ±‚åŠ è½½çš„æ•°æ®æ¡æ•°è¾ƒå°‘ï¼Œå¯¼è‡´åˆ—è¡¨å†…å®¹æ— æ³•é“ºæ»¡å½“å‰å±å¹•ï¼ŒList ä¼šç»§ç»­è§¦å‘ load äº‹ä»¶ï¼Œç›´åˆ°å†…å®¹é“ºæ»¡å±å¹•æˆ–æ•°æ®å…¨éƒ¨åŠ è½½å®Œæˆ
      -->
      <van-list
        v-model="loading"
        :finished="finished"
        finished-text="æ²¡æœ‰æ›´å¤šäº†"
        :error.sync="error"
        error-text="è¯·æ±‚å¤±è´¥ï¼Œç‚¹å‡»é‡æ–°åŠ è½½"
        @load="onLoad"
      >
        <van-cell
          v-for="(article, index) in list"
          :key="index"
          :title="article.title"
        />
      </van-list>
  </div>
</template>

<script>
import { getArticles } from '@/api/article'

export default {
  name: 'ArticleList',
  components: {},
  props: {
    channel: {
      type: Object,
      required: true
    }
  },
  data () {
    return {
      list: [], // æ–‡ç« åˆ—è¡¨æ•°æ®
      loading: false, // ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„ loading çŠ¶æ€
      finished: false, // æ˜¯å¦åŠ è½½ç»“æŸ
      error: false, // æ˜¯å¦åŠ è½½å¤±è´¥
      timestamp: null // è¯·æ±‚ä¸‹ä¸€é¡µæ•°æ®çš„æ—¶é—´æˆ³
    }
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {
    // å½“è§¦å‘ä¸Šæ‹‰åŠ è½½æ›´å¤šçš„æ—¶å€™è°ƒç”¨è¯¥å‡½æ•°
    async onLoad () {
      try {
        // 1. è¯·æ±‚è·å–æ•°æ®
        const { data } = await getArticles({
          channel_id: this.channel.id, // é¢‘é“ id
          timestamp: this.timestamp || Date.now(), // æ—¶é—´æˆ³ï¼Œè¯·æ±‚æ–°çš„æ¨èæ•°æ®ä¼ å½“å‰çš„æ—¶é—´æˆ³ï¼Œè¯·æ±‚å†å²æ¨èä¼ æŒ‡å®šçš„æ—¶é—´æˆ³
          with_top: 1 // æ˜¯å¦åŒ…å«ç½®é¡¶ï¼Œè¿›å…¥é¡µé¢ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶è¦åŒ…å«ç½®é¡¶æ–‡ç« ï¼Œ1-åŒ…å«ç½®é¡¶ï¼Œ0-ä¸åŒ…å«
        })

        // 2. æŠŠæ•°æ®æ·»åŠ åˆ° list æ•°ç»„ä¸­
        const { results } = data.data
        this.list.push(...results)

        // 3. è®¾ç½®æœ¬æ¬¡åŠ è½½ä¸­ loading çŠ¶æ€ç»“æŸ
        this.loading = false

        // 4. åˆ¤æ–­æ•°æ®æ˜¯å¦åŠ è½½ç»“æŸ
        if (results.length) {
          // æ›´æ–°è·å–ä¸‹ä¸€é¡µæ•°æ®çš„æ—¶é—´æˆ³
          this.timestamp = data.data.pre_timestamp
        } else {
          // æ²¡æœ‰æ•°æ®äº†ï¼Œè®¾ç½®åŠ è½½çŠ¶æ€ç»“æŸï¼Œä¸å†è§¦å‘ä¸Šæ‹‰åŠ è½½æ›´å¤šäº†
          this.finished = true
        }
      } catch (err) {
        console.log(err)
        this.loading = false // å…³é—­ loading æ•ˆæœ
        this.error = true // å¼€å¯é”™è¯¯æç¤º
      }
    }
  }
}
</script>

<style scoped lang="less"></style>

```

æœ€åæµ‹è¯•ã€‚



### ä¸‹æ‹‰åˆ·æ–°

<img src="assets/å±•ç¤ºæ–‡ç« åˆ—è¡¨-ä¸‹æ‹‰åˆ·æ–°.gif" alt="å±•ç¤ºæ–‡ç« åˆ—è¡¨-ä¸‹æ‹‰åˆ·æ–°" width="250" />

è¿™é‡Œä¸»è¦ä½¿ç”¨åˆ° Vant ä¸­çš„ [PullRefresh ä¸‹æ‹‰åˆ·æ–°](https://youzan.github.io/vant/#/zh-CN/pull-refresh) ç»„ä»¶ã€‚

æ€è·¯ï¼š

- æ³¨å†Œä¸‹æ‹‰åˆ·æ–°äº‹ä»¶ï¼ˆç»„ä»¶ï¼‰çš„å¤„ç†å‡½æ•°
- å‘é€è¯·æ±‚è·å–æ–‡ç« åˆ—è¡¨æ•°æ®
- æŠŠè·å–åˆ°çš„æ•°æ®æ·»åŠ åˆ°å½“å‰é¢‘é“çš„æ–‡ç« åˆ—è¡¨çš„é¡¶éƒ¨
- æç¤ºç”¨æˆ·åˆ·æ–°æˆåŠŸï¼

ä¸‹æ‹‰åˆ·æ–°æ—¶ä¼šè§¦å‘ç»„ä»¶çš„ `refresh` äº‹ä»¶ï¼Œåœ¨äº‹ä»¶çš„å›è°ƒå‡½æ•°ä¸­å¯ä»¥è¿›è¡ŒåŒæ­¥æˆ–å¼‚æ­¥æ“ä½œï¼Œæ“ä½œå®Œæˆåå°† `v-model` è®¾ç½®ä¸º `false`ï¼Œè¡¨ç¤ºåŠ è½½å®Œæˆã€‚

```js
// å½“è§¦å‘ä¸‹æ‹‰åˆ·æ–°çš„æ—¶å€™è°ƒç”¨è¯¥å‡½æ•°
async onRefresh () {
  try {
    // 1. è¯·æ±‚è·å–æ•°æ®
    const { data } = await getArticles({
      channel_id: this.channel.id, // é¢‘é“ id
      timestamp: Date.now(), // ä¸‹æ‹‰åˆ·æ–°æ¯æ¬¡éƒ½åº”è¯¥è·å–æœ€æ–°æ•°æ®
      with_top: 1 // æ˜¯å¦åŒ…å«ç½®é¡¶ï¼Œè¿›å…¥é¡µé¢ç¬¬ä¸€æ¬¡è¯·æ±‚æ—¶è¦åŒ…å«ç½®é¡¶æ–‡ç« ï¼Œ1-åŒ…å«ç½®é¡¶ï¼Œ0-ä¸åŒ…å«
    })

    // 2. å°†æ•°æ®è¿½åŠ åˆ°åˆ—è¡¨çš„é¡¶éƒ¨
    const { results } = data.data
    this.list.unshift(...results)

    // 3. å…³é—­ä¸‹æ‹‰åˆ·æ–°çš„ loading çŠ¶æ€
    this.isRefreshLoading = false

    // æç¤ºæˆåŠŸ
    this.refreshSuccessText = `åˆ·æ–°æˆåŠŸï¼Œæ›´æ–°äº†${results.length}æ¡æ•°æ®`
  } catch (err) {
    console.log(err)
    this.isRefreshLoading = false // å…³é—­ä¸‹æ‹‰åˆ·æ–°çš„ loading çŠ¶æ€
    this.$toast('åˆ·æ–°å¤±è´¥')
  }
}
```



## æ–‡ç« åˆ—è¡¨é¡¹

### å‡†å¤‡ç»„ä»¶

åœ¨æˆ‘ä»¬é¡¹ç›®ä¸­æœ‰å¥½å‡ ä¸ªé¡µé¢ä¸­éƒ½æœ‰è¿™ä¸ªæ–‡ç« åˆ—è¡¨é¡¹å†…å®¹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨æ¯ä¸ªé¡µé¢ä¸­éƒ½å†™ä¸€æ¬¡çš„è¯ä¸ä»…æ•ˆç‡ä½è€Œä¸”ç»´æŠ¤èµ·æ¥ä¹Ÿéº»çƒ¦ã€‚æ‰€ä»¥æœ€å¥½çš„åŠæ³•å°±æ˜¯æˆ‘ä»¬æŠŠå®ƒå°è£…ä¸ºä¸€ä¸ªç»„ä»¶ï¼Œç„¶ååœ¨éœ€è¦ä½¿ç”¨çš„ç»„ä»¶ä¸­åŠ è½½ä½¿ç”¨å³å¯ã€‚

1ã€åˆ›å»º `src/components/article-item/index.vue` ç»„ä»¶

```html
<template>
  <div class="article-item">æ–‡ç« åˆ—è¡¨é¡¹</div>
</template>

<script>
export default {
  name: 'ArticleItem',
  components: {},
  props: {
    article: {
      type: Object,
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```



2ã€åœ¨æ–‡ç« åˆ—è¡¨ç»„ä»¶ä¸­æ³¨å†Œä½¿ç”¨æ–‡ç« åˆ—è¡¨é¡¹ç»„ä»¶

<img src="assets/image-20200404224728524.png" alt="image-20200404224728524" style="zoom:50%;" />

### å±•ç¤ºåˆ—è¡¨é¡¹å†…å®¹

- ä½¿ç”¨ Cell å•å…ƒæ ¼ç»„ä»¶
- å±•ç¤ºæ ‡é¢˜
- å±•ç¤ºåº•éƒ¨ä¿¡æ¯

```html
<template>
  <van-cell
    class="article-item"
  >
    <div slot="title" class="title">{{ article.title }}</div>
    <div slot="label">
      <div v-if="article.cover.type === 3" class="cover-wrap">
        <div
          class="cover-item"
          v-for="(img, index) in article.cover.images"
          :key="index"
        >
          <van-image
            width="100"
            height="100"
            :src="img"
          />
        </div>
      </div>
      <div>
        <span>{{ article.aut_name }}</span>
        <span>{{ article.comm_count }}è¯„è®º</span>
        <span>{{ article.pubdate }}</span>
      </div>
    </div>
    <van-image
      v-if="article.cover.type === 1"
      slot="default"
      width="100"
      height="100"
      :src="article.cover.images[0]"
    />
  </van-cell>
</template>

<script>
export default {
  name: 'ArticleItem',
  components: {},
  props: {
    article: {
      type: Object,
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less"></style>

```

### æ ·å¼è°ƒæ•´

- æ–‡ç« æ ‡é¢˜
  + å­—å·
  + é¢œè‰²
  + å¤šè¡Œæ–‡å­—çœç•¥
- å•å›¾å°é¢
  + å°é¢å®¹å™¨
    * å»é™¤ flex: 1ï¼Œå›ºå®šå®½é«˜
    * å·¦å†…è¾¹è·
  + å°é¢å›¾
    * å®½é«˜
    * å¡«å……æ¨¡å¼ï¼šcover
- åº•éƒ¨æ–‡æœ¬ä¿¡æ¯
  + å­—å·
  + é¢œè‰²
  + é—´è·
- å¤šå›¾å°é¢
  + å¤–å±‚å®¹å™¨
    * flex å®¹å™¨
    * ä¸Šä¸‹å¤–è¾¹è·
  + å›¾ç‰‡å®¹å™¨
    * å¹³å‡åˆ†é…å®¹å™¨ç©ºé—´ï¼šflex: 1;
    * å›ºå®šé«˜åº¦
    * å®¹å™¨é¡¹é—´è·
  + å›¾ç‰‡
    * å®½é«˜
    * å¡«å……æ¨¡å¼


ä»¥ä¸‹ä»£ç ä»…ä¾›å‚è€ƒã€‚

```html
<template>
  <van-cell
    class="article-item"
  >
    <div slot="title" class="title van-multi-ellipsis--l2">{{ article.title }}</div>
    <div slot="label">
      <div v-if="article.cover.type === 3" class="cover-wrap">
        <div
          class="cover-item"
          v-for="(img, index) in article.cover.images"
          :key="index"
        >
          <van-image
            class="cover-item-img"
            fit="cover"
            :src="img"
          />
        </div>
      </div>
      <div class="label-info-wrap">
        <span>{{ article.aut_name }}</span>
        <span>{{ article.comm_count }}è¯„è®º</span>
        <span>{{ article.pubdate }}</span>
      </div>
    </div>
    <van-image
      v-if="article.cover.type === 1"
      slot="default"
      class="right-cover"
      fit="cover"
      :src="article.cover.images[0]"
    />
  </van-cell>
</template>

<script>
export default {
  name: 'ArticleItem',
  components: {},
  props: {
    article: {
      type: Object,
      required: true
    }
  },
  data () {
    return {}
  },
  computed: {},
  watch: {},
  created () {},
  mounted () {},
  methods: {}
}
</script>

<style scoped lang="less">
.article-item {
  .title {
    font-size: 32px;
    color: #3a3a3a;
  }

  .van-cell__value {
    flex: unset;
    width: 232px;
    height: 146px;
    padding-left: 25px;
  }

  .right-cover {
    width: 232px;
    height: 146px;
  }

  .label-info-wrap span {
    font-size: 22px;
    color: #b4b4b4;
    margin-right: 25px;
  }

  .cover-wrap {
    display: flex;
    padding: 30px 0;
    .cover-item {
      flex: 1;
      height: 146px;
      &:not(:last-child) {
        padding-right: 4px;
      }
      .cover-item-img {
        width: 100%;
        height: 146px;
      }
    }
  }
}
</style>

```



### å…³äºç¬¬ä¸‰æ–¹å›¾ç‰‡èµ„æº403é—®é¢˜

ä¸ºä»€ä¹ˆæ–‡ç« åˆ—è¡¨æ•°æ®ä¸­çš„å¥½å¤šå›¾ç‰‡èµ„æºè¯·æ±‚å¤±è´¥è¿”å› 403ï¼Ÿ

```
è¿™æ˜¯å› ä¸ºæˆ‘ä»¬é¡¹ç›®çš„æ¥å£æ•°æ®æ˜¯åç«¯é€šè¿‡çˆ¬è™«æŠ“å–çš„ç¬¬ä¸‰æ–¹å¹³å°å†…å®¹ï¼Œè€Œç¬¬ä¸‰æ–¹å¹³å°å¯¹å›¾ç‰‡èµ„æºåšäº†é˜²ç›—é“¾ä¿æŠ¤å¤„ç†ã€‚
```



ç¬¬ä¸‰æ–¹å¹³å°æ€ä¹ˆå¤„ç†å›¾ç‰‡èµ„æºä¿æŠ¤çš„ï¼Ÿ

```
æœåŠ¡ç«¯ä¸€èˆ¬ä½¿ç”¨ Referer è¯·æ±‚å¤´è¯†åˆ«è®¿é—®æ¥æºï¼Œç„¶åå¤„ç†èµ„æºè®¿é—®ã€‚
```

<img src="assets/image-20200405134347749.png" alt="image-20200405134347749"  />



Referer æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿ

> æ‰©å±•å‚è€ƒï¼šhttp://www.ruanyifeng.com/blog/2019/06/http-referer.html

```
Referer æ˜¯ HTTP è¯·æ±‚å¤´çš„ä¸€éƒ¨åˆ†ï¼Œå½“æµè§ˆå™¨å‘ Web æœåŠ¡å™¨å‘é€è¯·æ±‚çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šå¸¦ä¸Š Refererï¼Œå®ƒåŒ…å«äº†å½“å‰è¯·æ±‚èµ„æºçš„æ¥æºé¡µé¢çš„åœ°å€ã€‚æœåŠ¡ç«¯ä¸€èˆ¬ä½¿ç”¨ Referer è¯·æ±‚å¤´è¯†åˆ«è®¿é—®æ¥æºï¼Œå¯èƒ½ä¼šä»¥æ­¤è¿›è¡Œç»Ÿè®¡åˆ†æã€æ—¥å¿—è®°å½•ä»¥åŠç¼“å­˜ä¼˜åŒ–ç­‰ã€‚
```

> éœ€è¦æ³¨æ„çš„æ˜¯ referer å®é™…ä¸Šæ˜¯ "referrer" è¯¯æ‹¼å†™ã€‚å‚è§ [HTTP referer on Wikipedia](https://zh.wikipedia.org/wiki/HTTP_referer) ï¼ˆHTTP referer åœ¨ç»´åŸºç™¾ç§‘ä¸Šçš„æ¡ç›®ï¼‰æ¥è·å–æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚



æ€ä¹ˆè§£å†³ï¼Ÿ

```
ä¸è¦å‘é€ referrer ï¼Œå¯¹æ–¹æœåŠ¡ç«¯å°±ä¸çŸ¥é“ä½ ä»å“ªæ¥çš„äº†ï¼Œå§‘ä¸”è®¤ä¸ºæ˜¯ä½ æ˜¯è‡ªå·±äººå§ã€‚
```



å¦‚ä½•è®¾ç½®ä¸å‘é€ referrerï¼Ÿ

ç”¨ `<a>`ã€`<area>`ã€`<img>`ã€`<iframe>`ã€`<script>` æˆ–è€… `<link>` å…ƒç´ ä¸Šçš„ `referrerpolicy` å±æ€§ä¸ºå…¶è®¾ç½®ç‹¬ç«‹çš„è¯·æ±‚ç­–ç•¥ï¼Œä¾‹å¦‚ï¼š

```html
<img src="http://â€¦â€¦" referrerPolicy="no-referrer">
```

æˆ–è€…ç›´æ¥åœ¨ HTMl é¡µé¢å¤´ä¸­é€šè¿‡ meta å±æ€§å…¨å±€é…ç½®ï¼š

```html
<meta name="referrer" content="no-referrer" />
```

### å¤„ç†ç›¸å¯¹æ—¶é—´

æ¨èä¸¤ä¸ªç¬¬ä¸‰æ–¹åº“ï¼š

- [Moment.js](https://momentjs.com/)
- [Day.js](https://day.js.org/)

ä¸¤è€…éƒ½æ˜¯ä¸“é—¨ç”¨äºå¤„ç†æ—¶é—´çš„ JavaScript åº“ï¼ŒåŠŸèƒ½å·®ä¸å¤šï¼Œå› ä¸º Day.js çš„è®¾è®¡å°±æ˜¯å‚è€ƒçš„ Moment.jsã€‚ä½†æ˜¯ Day.js ç›¸æ¯” Moment.js çš„åŒ…ä½“ç§¯è¦æ›´å°ä¸€äº›ï¼Œå› ä¸ºå®ƒé‡‡ç”¨äº†æ’ä»¶åŒ–çš„å¤„ç†æ–¹å¼ã€‚

[Day.js](https://day.js.org/zh-CN/) æ˜¯ä¸€ä¸ªè½»é‡çš„å¤„ç†æ—¶é—´å’Œæ—¥æœŸçš„ JavaScript åº“ï¼Œå’Œ [Moment.js](https://momentjs.com/) çš„ API è®¾è®¡ä¿æŒå®Œå…¨ä¸€æ ·ï¼Œå¦‚æœæ‚¨æ›¾ç»ç”¨è¿‡ Moment.js, é‚£ä¹ˆæ‚¨å·²ç»çŸ¥é“å¦‚ä½•ä½¿ç”¨ Day.js ã€‚

- Day.js å¯ä»¥è¿è¡Œåœ¨æµè§ˆå™¨å’Œ Node.js ä¸­ã€‚

- ğŸ•’ å’Œ Moment.js ç›¸åŒçš„ API å’Œç”¨æ³•
- ğŸ’ª ä¸å¯å˜æ•°æ® (Immutable)
- ğŸ”¥ æ”¯æŒé“¾å¼æ“ä½œ (Chainable)
- ğŸŒ å›½é™…åŒ– I18n
- ğŸ“¦ ä»… 2kb å¤§å°çš„å¾®å‹åº“
- ğŸ‘« å…¨æµè§ˆå™¨å…¼å®¹



1ã€å®‰è£…

```sh
npm i dayjs
```

2ã€åˆ›å»º `utils/dayjs.js`

```js
import Vue from 'vue'
import dayjs from 'dayjs'

// åŠ è½½ä¸­æ–‡è¯­è¨€åŒ…
import 'dayjs/locale/zh-cn'

import relativeTime from 'dayjs/plugin/relativeTime'

// é…ç½®ä½¿ç”¨å¤„ç†ç›¸å¯¹æ—¶é—´çš„æ’ä»¶
dayjs.extend(relativeTime)

// é…ç½®ä½¿ç”¨ä¸­æ–‡è¯­è¨€åŒ…
dayjs.locale('zh-cn')

// å…¨å±€è¿‡æ»¤å™¨ï¼šå¤„ç†ç›¸å¯¹æ—¶é—´
Vue.filter('relativeTime', value => {
  return dayjs().to(dayjs(value))
})

```

3ã€åœ¨ `main.js` ä¸­åŠ è½½åˆå§‹åŒ–

```js
import './utils/dayjs'
```

4ã€ä½¿ç”¨

ä½¿ç”¨è¿‡æ»¤å™¨ï¼š

```html
<p>{{ æ—¥æœŸæ•°æ® | relativeTime }}</p>
```



